!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.flv2canvas=e()}}(function(){var e;return function(){function e(t,i,r){function n(o,s){if(!i[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[o]={exports:{}};t[o][0].call(h.exports,function(e){return n(t[o][1][e]||e)},h,h.exports,e,t,i,r)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}return e}()({1:[function(t,i,r){(function(n,a){!function(t,n){"object"==typeof r&&void 0!==i?i.exports=n():"function"==typeof e&&e.amd?e(n):t.ES6Promise=n()}(this,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function i(e){return"function"==typeof e}function r(e){G=e}function o(e){V=e}function s(){return void 0!==M?function(){M(l)}:u()}function u(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<j;e+=2){(0,K[e])(K[e+1]),K[e]=void 0,K[e+1]=void 0}j=0}function h(e,t){var i=this,r=new this.constructor(c);void 0===r[q]&&R(r);var n=i._state;if(n){var a=arguments[n-1];V(function(){return x(n,r,a,i._result)})}else E(i,r,e,t);return r}function f(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(c);return m(i,e),i}function c(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function p(e,t,i,r){try{e.call(t,i,r)}catch(e){return e}}function _(e,t,i){V(function(e){var r=!1,n=p(i,t,function(i){r||(r=!0,t!==i?m(e,i):A(e,i))},function(t){r||(r=!0,w(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&n&&(r=!0,w(e,n))},e)}function y(e,t){t._state===J?A(e,t._result):t._state===Q?w(e,t._result):E(t,void 0,function(t){return m(e,t)},function(t){return w(e,t)})}function g(e,t,r){t.constructor===e.constructor&&r===h&&t.constructor.resolve===f?y(e,t):void 0===r?A(e,t):i(r)?_(e,t,r):A(e,t)}function m(t,i){if(t===i)w(t,d());else if(e(i)){var r=void 0;try{r=i.then}catch(e){return void w(t,e)}g(t,i,r)}else A(t,i)}function b(e){e._onerror&&e._onerror(e._result),T(e)}function A(e,t){e._state===Z&&(e._result=t,e._state=J,0!==e._subscribers.length&&V(T,e))}function w(e,t){e._state===Z&&(e._state=Q,e._result=t,V(b,e))}function E(e,t,i,r){var n=e._subscribers,a=n.length;e._onerror=null,n[a]=t,n[a+J]=i,n[a+Q]=r,0===a&&e._state&&V(T,e)}function T(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var r=void 0,n=void 0,a=e._result,o=0;o<t.length;o+=3)r=t[o],n=t[o+i],r?x(i,r,n,a):n(a);e._subscribers.length=0}}function x(e,t,r,n){var a=i(r),o=void 0,s=void 0,u=!0;if(a){try{o=r(n)}catch(e){u=!1,s=e}if(t===o)return void w(t,v())}else o=n;t._state!==Z||(a&&u?m(t,o):!1===u?w(t,s):e===J?A(t,o):e===Q&&w(t,o))}function C(e,t){try{t(function(t){m(e,t)},function(t){w(e,t)})}catch(t){w(e,t)}}function k(){return $++}function R(e){e[q]=$++,e._state=void 0,e._result=void 0,e._subscribers=[]}function L(){return new Error("Array Methods must be provided an Array")}function D(e){return new ee(this,e).promise}function S(e){var t=this;return new t(F(e)?function(i,r){for(var n=e.length,a=0;a<n;a++)t.resolve(e[a]).then(i,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,i=new t(c);return w(i,e),i}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function P(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(){var e=void 0;if(void 0!==a)e=a;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=te}var I=void 0;I=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var F=I,j=0,M=void 0,G=void 0,V=function(e,t){K[j]=e,K[j+1]=t,2===(j+=2)&&(G?G(l):H())},N="undefined"!=typeof window?window:void 0,z=N||{},Y=z.MutationObserver||z.WebKitMutationObserver,X="undefined"==typeof self&&void 0!==n&&"[object process]"==={}.toString.call(n),W="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,K=new Array(1e3),H=void 0;H=X?function(){return function(){return n.nextTick(l)}}():Y?function(){var e=0,t=new Y(l),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}():W?function(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}():void 0===N&&"function"==typeof t?function(){try{var e=Function("return this")().require("vertx");return M=e.runOnLoop||e.runOnContext,s()}catch(e){return u()}}():u();var q=Math.random().toString(36).substring(2),Z=void 0,J=1,Q=2,$=0,ee=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[q]||R(this.promise),F(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&A(this.promise,this._result))):w(this.promise,L())}return e.prototype._enumerate=function(e){for(var t=0;this._state===Z&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===f){var n=void 0,a=void 0,o=!1;try{n=e.then}catch(e){o=!0,a=e}if(n===h&&e._state!==Z)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(i===te){var s=new i(c);o?w(s,a):g(s,e,n),this._willSettleAt(s,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,i){var r=this.promise;r._state===Z&&(this._remaining--,e===Q?w(r,i):this._result[t]=i),0===this._remaining&&A(r,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;E(e,void 0,function(e){return i._settledAt(J,t,e)},function(e){return i._settledAt(Q,t,e)})},e}(),te=function(){function e(t){this[q]=k(),this._result=this._state=void 0,this._subscribers=[],c!==t&&("function"!=typeof t&&O(),this instanceof e?C(this,t):P())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,r=t.constructor;return i(e)?t.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return te.prototype.then=h,te.all=D,te.race=S,te.resolve=f,te.reject=B,te._setScheduler=r,te._setAsap=o,te._asap=V,te.polyfill=U,te.Promise=te,te})}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(e,t,i){function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=A(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function n(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function a(e,t,i){if(t)e.call(i);else for(var r=e.length,n=_(e,r),a=0;a<r;++a)n[a].call(i)}function o(e,t,i,r){if(t)e.call(i,r);else for(var n=e.length,a=_(e,n),o=0;o<n;++o)a[o].call(i,r)}function s(e,t,i,r,n){if(t)e.call(i,r,n);else for(var a=e.length,o=_(e,a),s=0;s<a;++s)o[s].call(i,r,n)}function u(e,t,i,r,n,a){if(t)e.call(i,r,n,a);else for(var o=e.length,s=_(e,o),u=0;u<o;++u)s[u].call(i,r,n,a)}function l(e,t,i,r){if(t)e.apply(i,r);else for(var n=e.length,a=_(e,n),o=0;o<n;++o)a[o].apply(i,r)}function h(e,t,i,r){var a,o,s;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if(o=e._events,o?(o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),s=o[t]):(o=e._events=A(null),e._eventsCount=0),s){if("function"==typeof s?s=o[t]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),!s.warned&&(a=n(e))&&a>0&&s.length>a){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",u.name,u.message)}}else s=o[t]=i,++e._eventsCount;return e}function f(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function c(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=E.call(f,r);return n.listener=i,r.wrapFn=n,n}function d(e,t,i){var r=e._events;if(!r)return[];var n=r[t];return n?"function"==typeof n?i?[n.listener||n]:[n]:i?y(n):_(n,n.length):[]}function v(e){var t=this._events;if(t){var i=t[e];if("function"==typeof i)return 1;if(i)return i.length}return 0}function p(e,t){for(var i=t,r=i+1,n=e.length;r<n;i+=1,r+=1)e[i]=e[r];e.pop()}function _(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}function y(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}function g(e){var t=function(){};return t.prototype=e,new t}function m(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return i}function b(e){var t=this;return function(){return t.apply(e,arguments)}}var A=Object.create||g,w=Object.keys||m,E=Function.prototype.bind||b;t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var T,x=10;try{var C={};Object.defineProperty&&Object.defineProperty(C,"x",{value:0}),T=0===C.x}catch(e){T=!1}T?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return x},set:function(e){if("number"!=typeof e||e<0||e!==e)throw new TypeError('"defaultMaxListeners" must be a positive number');x=e}}):r.defaultMaxListeners=x,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return n(this)},r.prototype.emit=function(e){var t,i,r,n,h,f,c="error"===e;if(f=this._events)c=c&&null==f.error;else if(!c)return!1;if(c){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var d=new Error('Unhandled "error" event. ('+t+")");throw d.context=t,d}if(!(i=f[e]))return!1;var v="function"==typeof i;switch(r=arguments.length){case 1:a(i,v,this);break;case 2:o(i,v,this,arguments[1]);break;case 3:s(i,v,this,arguments[1],arguments[2]);break;case 4:u(i,v,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),h=1;h<r;h++)n[h-1]=arguments[h];l(i,v,this,n)}return!0},r.prototype.addListener=function(e,t){return h(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return h(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,c(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,c(this,e,t)),this},r.prototype.removeListener=function(e,t){var i,r,n,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=A(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){o=i[a].listener,n=a;break}if(n<0)return this;0===n?i.shift():p(i,n),1===i.length&&(r[e]=i[0]),r.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.removeAllListeners=function(e){var t,i,r;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=A(null),this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=A(null):delete i[e]),this;if(0===arguments.length){var n,a=w(i);for(r=0;r<a.length;++r)"removeListener"!==(n=a[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=A(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},r.prototype.listeners=function(e){return d(this,e,!0)},r.prototype.rawListeners=function(e){return d(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},r.prototype.listenerCount=v,r.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],3:[function(e,t,i){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function a(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function o(e){if(c===clearTimeout)return clearTimeout(e);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function s(){_&&v&&(_=!1,v.length?p=v.concat(p):y=-1,p.length&&u())}function u(){if(!_){var e=a(s);_=!0;for(var t=p.length;t;){for(v=p,p=[];++y<t;)v&&v[y].run();y=-1,t=p.length}v=null,_=!1,o(e)}}function l(e,t){this.fun=e,this.array=t}function h(){}var f,c,d=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(e){c=n}}();var v,p=[],_=!1,y=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];p.push(new l(e,t)),1!==p.length||_||a(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.prependListener=h,d.prependOnceListener=h,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e){var t={encoding:"32bitFloat",flushingTime:1e3};this.option=Object.assign({},t,e),this.samples=new Float32Array,this.sampleRate=null,this.flush=this.flush.bind(this),this.interval=setInterval(this.flush,this.option.flushingTime),this.maxValue=this.getMaxValue(),this.typedArray=this.getTypedArray(),this.createContext(),this.flush()}return e.prototype.getMaxValue=function(){var e={"8bitInt":128,"16bitInt":32768,"32bitInt":2147483648,"32bitFloat":1};return e[this.option.encoding]?e[this.option.encoding]:e["16bitInt"]},e.prototype.getTypedArray=function(){var e={"8bitInt":Int8Array,"16bitInt":Int16Array,"32bitInt":Int32Array,"32bitFloat":Float32Array};return e[this.option.encoding]?e[this.option.encoding]:e["16bitInt"]},e.prototype.createContext=function(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),window.audioCtx=this.audioCtx,this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioCtx.destination),this.startTime=this.audioCtx.currentTime},e.prototype.isTypedArray=function(e){return e.byteLength&&e.buffer&&e.buffer.constructor==ArrayBuffer},e.prototype.feed=function(e){if(this.isTypedArray(e)){e=new this.typedArray(e.buffer);var t=new Float32Array(this.samples.length+e.length);t.set(this.samples,0),t.set(e,this.samples.length),this.samples=t}},e.prototype.clean=function(){this.samples=new this.typedArray},e.prototype.getFormatedValue=function(e){var t=new this.typedArray(e.buffer),i=new Float32Array(e.length);return i.set(t,0),i},e.prototype.volume=function(e){this.gainNode.gain.value=e},e.prototype.destroy=function(){this.interval&&clearInterval(this.interval),this.samples=null,this.audioCtx.close(),this.audioCtx=null,window.audioCtx=null},e.prototype.flush=function(){if(this.samples.length){var e=this.audioCtx.createBufferSource(),t=this.samples.length/this.option.channels,i=this.audioCtx.createBuffer(this.option.channels,t,this.sampleRate),r=void 0,n=void 0,a=void 0,o=void 0,s=void 0;for(n=0;n<this.option.channels;n++)for(r=i.getChannelData(n),a=n,s=50,o=0;o<t;o++)r[o]=this.samples[a],o<50&&(r[o]=r[o]*o/50),o>=t-51&&(r[o]=r[o]*s--/50),a+=this.option.channels;this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),e.buffer=i,e.connect(this.gainNode),e.start(this.startTime),this.startTime+=i.duration,this.samples=new Float32Array}},e}();i.default=r},{}],5:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return n(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,i=this._search(t.times,e);return{index:i,milliseconds:t.times[i],fileposition:t.filepositions[i]}}},{key:"_search",value:function(e,t){var i=0,r=e.length-1,n=0,a=0,o=r;for(t<e[0]&&(i=0,a=o+1);a<=o;){if((n=a+Math.floor((o-a)/2))===r||t>=e[n]&&t<e[n+1]){i=n;break}e[n]<t?a=n+1:o=n-1}return i}}]),e}();i.default=a},{}],6:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=e("../utils/logger.js"),s=r(o),u=e("../utils/utf8-conv.js"),l=r(u),h=e("../utils/exception.js"),f=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),c=function(){function e(){n(this,e)}return a(e,null,[{key:"parseScriptData",value:function(t,i,r){var n={};try{var a=e.parseValue(t,i,r),o=e.parseValue(t,i+a.size,r-a.size);n[a.data]=o.data}catch(e){s.default.e("AMF",e.toString())}return n}},{key:"parseObject",value:function(t,i,r){if(r<3)throw new h.IllegalStateException("Data not enough when parse ScriptDataObject");var n=e.parseString(t,i,r),a=e.parseValue(t,i+n.size,r-n.size),o=a.objectEnd;return{data:{name:n.data,value:a.data},size:n.size+a.size,objectEnd:o}}},{key:"parseVariable",value:function(t,i,r){return e.parseObject(t,i,r)}},{key:"parseString",value:function(e,t,i){if(i<2)throw new h.IllegalStateException("Data not enough when parse String");var r=new DataView(e,t,i),n=r.getUint16(0,!f),a=void 0;return a=n>0?(0,l.default)(new Uint8Array(e,t+2,n)):"",{data:a,size:2+n}}},{key:"parseLongString",value:function(e,t,i){if(i<4)throw new h.IllegalStateException("Data not enough when parse LongString");var r=new DataView(e,t,i),n=r.getUint32(0,!f),a=void 0;return a=n>0?(0,l.default)(new Uint8Array(e,t+4,n)):"",{data:a,size:4+n}}},{key:"parseDate",value:function(e,t,i){if(i<10)throw new h.IllegalStateException("Data size invalid when parse Date");var r=new DataView(e,t,i),n=r.getFloat64(0,!f);return n+=60*r.getInt16(8,!f)*1e3,{data:new Date(n),size:10}}},{key:"parseValue",value:function(t,i,r){if(r<1)throw new h.IllegalStateException("Data not enough when parse Value");var n=new DataView(t,i,r),a=1,o=n.getUint8(0),u=void 0,l=!1;try{switch(o){case 0:u=n.getFloat64(1,!f),a+=8;break;case 1:u=!!n.getUint8(1),a+=1;break;case 2:var c=e.parseString(t,i+1,r-1);u=c.data,a+=c.size;break;case 3:u={};var d=0;for(9==(16777215&n.getUint32(r-4,!f))&&(d=3);a<r-4;){var v=e.parseObject(t,i+a,r-a-d);if(v.objectEnd)break;u[v.data.name]=v.data.value,a+=v.size}if(a<=r-3){9===(16777215&n.getUint32(a-1,!f))&&(a+=3)}break;case 8:u={},a+=4;var p=0;for(9==(16777215&n.getUint32(r-4,!f))&&(p=3);a<r-8;){var _=e.parseVariable(t,i+a,r-a-p);if(_.objectEnd)break;u[_.data.name]=_.data.value,a+=_.size}if(a<=r-3){9===(16777215&n.getUint32(a-1,!f))&&(a+=3)}break;case 9:u=void 0,a=1,l=!0;break;case 10:u=[];var y=n.getUint32(1,!f);a+=4;for(var g=0;g<y;g++){var m=e.parseValue(t,i+a,r-a);u.push(m.data),a+=m.size}break;case 11:var b=e.parseDate(t,i+1,r-1);u=b.data,a+=b.size;break;case 12:var A=e.parseString(t,i+1,r-1);u=A.data,a+=A.size;break;default:a=r,s.default.w("AMF","Unsupported AMF value type "+o)}}catch(e){s.default.e("AMF",e.toString())}return{data:u,size:a,objectEnd:l}}}]),e}();i.default=c},{"../utils/exception.js":20,"../utils/logger.js":21,"../utils/utf8-conv.js":23}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};i.default=r},{}],8:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=e("../utils/exception.js"),o=function(){function e(t){r(this,e),this.TAG="ExpGolomb",this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return n(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new a.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new a.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(r,this._current_word_bits_left),o=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,i=i<<n|o}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();i.default=o},{"../utils/exception.js":20}],9:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){if(Array.isArray(e)){for(var t=Array(e.length),i=0;i<e.length;i++)t[i]=e[i];return t}return Array.from(e)}function o(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}Object.defineProperty(i,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l=e("../utils/logger.js"),h=r(l),f=e("./amf-parser.js"),c=r(f),d=e("./sps-parser.js"),v=r(d),p=e("./demux-errors.js"),_=r(p),y=e("../core/media-info.js"),g=r(y),m=(e("../utils/exception.js"),function(){function e(t,i){n(this,e),this.TAG="FLVDemuxer",this._config=i,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new g.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return u(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this.onAudioParseDone=null,this.onVideoParseDone=null}},{key:"bindDataSource",value:function(e){return this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new g.default}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(t,i){var r=0,n=this._littleEndian;if(0===i){if(!(t.byteLength>13))return 0;r=e.probe(t).dataOffset}if(this._firstParse){this._firstParse=!1,i+r!==this._dataOffset&&h.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");0!==new DataView(t,r).getUint32(0,!n)&&h.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),r+=4}for(;r<t.byteLength;){this._dispatch=!0;var a=new DataView(t,r);if(r+11+4>t.byteLength)break;var o=a.getUint8(0),s=16777215&a.getUint32(0,!n);if(r+11+s+4>t.byteLength)break;if(8===o||9===o||18===o){var u=a.getUint8(4),l=a.getUint8(5),f=a.getUint8(6),c=a.getUint8(7),d=f|l<<8|u<<16|c<<24;0!==(16777215&a.getUint32(7,!n))&&h.default.w(this.TAG,"Meet tag which has StreamID != 0!");var v=r+11;switch(o){case 8:this._parseAudioData(t,v,s,d);break;case 9:this._parseVideoData(t,v,s,d,i+r);break;case 18:this._parseScriptData(t,v,s)}var p=a.getUint32(11+s,!n);p!==11+s&&h.default.w(this.TAG,"Invalid PrevTagSize "+p),r+=11+s+4}else h.default.w(this.TAG,"Unsupported tag type "+o+", skipped"),r+=11+s+4}return r}},{key:"_parseScriptData",value:function(e,t,i){var r=c.default.parseScriptData(e,t,i);if(r.hasOwnProperty("onMetaData")){if(null==r.onMetaData||"object"!==s(r.onMetaData))return void h.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&h.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var n=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},n)),"boolean"==typeof n.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=n.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof n.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=n.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof n.audiodatarate&&(this._mediaInfo.audioDataRate=n.audiodatarate),"number"==typeof n.videodatarate&&(this._mediaInfo.videoDataRate=n.videodatarate),"number"==typeof n.width&&(this._mediaInfo.width=n.width),"number"==typeof n.height&&(this._mediaInfo.height=n.height),"number"==typeof n.duration){if(!this._durationOverrided){var a=Math.floor(n.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof n.framerate){var o=Math.floor(1e3*n.framerate);if(o>0){var u=o/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=u,this._referenceFrameRate.fps_num=o,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=u}}if("object"===s(n.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var l=n.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(l),n.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=n,h.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}
Object.keys(r).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},r))}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],i=[],r=1;r<e.times.length;r++){var n=this._timestampBase+Math.floor(1e3*e.times[r]);t.push(n),i.push(e.filepositions[r])}return{times:t,filepositions:i}}},{key:"_parseAudioData",value:function(e,t,i,r){if(i<=1)return void h.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){var n=(this._littleEndian,new DataView(e,t,i)),o=n.getUint8(0),s=o>>>4;if(2!==s&&10!==s)return void this._onError(_.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s);var u=0,l=(12&o)>>>2;if(!(l>=0&&l<=4))return void this._onError(_.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l);u=this._flvSoundRateTable[l];var f=1&o,c=this._audioMetadata,d=this._audioTrack;if(c||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),c=this._audioMetadata={},c.type="audio",c.id=d.id,c.timescale=this._timescale,c.duration=this._duration,c.audioSampleRate=u,c.channelCount=0===f?1:2),10===s){var v=this._parseAACAudioData(e,t+1,i-1);if(void 0==v)return;if(0===v.packetType){c.config&&h.default.w(this.TAG,"Found another AudioSpecificConfig!");var p=v.data;c.audioSampleRate=p.samplingRate,c.channelCount=p.channelCount,c.codec=p.codec,c.originalCodec=p.originalCodec,c.config=p.config,c.configRaw=p.configRaw,c.audioObjectType=p.audioObjectType,c.samplingFrequencyIndex=p.samplingIndex,c.channelConfig=p.channelCount,c.refSampleDuration=1024/c.audioSampleRate*c.timescale,h.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this.HEADER={audioObjectType:c.audioObjectType,samplingFrequencyIndex:c.samplingFrequencyIndex,channelConfig:c.channelConfig};var y=this._mediaInfo;y.audioCodec=c.originalCodec,y.audioSampleRate=c.audioSampleRate,y.audioChannelCount=c.channelCount,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()}else if(1===v.packetType){var g=this._timestampBase+r,m={unit:v.data,length:v.data.byteLength,dts:g,pts:g},b=this,A=function(e){var t=e.audioObjectType,i=e.samplingFrequencyIndex,r=e.channelConfig,n=e.adtsLen,a=new Uint8Array(7);return a[0]=255,a[1]=240,a[1]|=0,a[1]|=0,a[1]|=1,a[2]=t-1<<6,a[2]|=(15&i)<<2,a[2]|=0,a[2]|=(4&r)>>2,a[3]=(3&r)<<6,a[3]|=0,a[3]|=0,a[3]|=0,a[3]|=0,a[3]|=(6144&n)>>11,a[4]=(2040&n)>>3,a[5]=(7&n)<<5,a[5]|=31,a[6]=252,a}({audioObjectType:b.HEADER.audioObjectType,samplingFrequencyIndex:b.HEADER.samplingFrequencyIndex,channelConfig:b.HEADER.channelConfig,adtsLen:m.length+7}),w=[];w.push.apply(w,a(A).concat(a(m.unit))),this.onAudioParseDone(w)}else h.default.e(this.TAG,"Flv: Unsupported AAC data type "+v.packetType)}else if(2===s){if(!c.codec){var E=this._parseMP3AudioData(e,t+1,i-1,!0);if(void 0==E)return;c.audioSampleRate=E.samplingRate,c.channelCount=E.channelCount,c.codec=E.codec,c.originalCodec=E.originalCodec,c.refSampleDuration=1152/c.audioSampleRate*c.timescale,h.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0;var T=this._mediaInfo;T.audioCodec=c.codec,T.audioSampleRate=c.audioSampleRate,T.audioChannelCount=c.channelCount,T.audioDataRate=E.bitRate,T.hasVideo?null!=T.videoCodec&&(T.mimeType='video/x-flv; codecs="'+T.videoCodec+","+T.audioCodec+'"'):T.mimeType='video/x-flv; codecs="'+T.audioCodec+'"',T.isComplete()&&this._onMediaInfo(T)}var x=this._parseMP3AudioData(e,t+1,i-1,!1);if(void 0==x)return;var C=this._timestampBase+r,k={unit:x,length:x.byteLength,dts:C,pts:C};d.samples.push(k),d.length+=x.length}}}},{key:"_parseAACAudioData",value:function(e,t,i){if(i<=1)return void h.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");var r={},n=new Uint8Array(e,t,i);if(r.packetType=n[0],0===n[0]){r.data=this._parseAACAudioSpecificConfig(e,t+1,i-1)}else r.data=n.subarray(1);return r}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,i){var r=new Uint8Array(e,t,i),n=null,a=0,o=0,s=0,u=null;if(a=o=r[0]>>>3,(s=(7&r[0])<<1|r[1]>>>7)<0||s>=this._mpegSamplingRates.length)return void this._onError(_.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");var l=this._mpegSamplingRates[s],h=(120&r[1])>>>3;if(h<0||h>=8)return void this._onError(_.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");5===a&&(u=(7&r[1])<<1|r[2]>>>7,r[2]);var f=self.navigator.userAgent.toLowerCase();return-1!==f.indexOf("firefox")?s>=6?(a=5,n=new Array(4),u=s-3):(a=2,n=new Array(2),u=s):-1!==f.indexOf("android")?(a=2,n=new Array(2),u=s):(a=5,u=s,n=new Array(4),s>=6?u=s-3:1===h&&(a=2,n=new Array(2),u=s)),n[0]=a<<3,n[0]|=(15&s)>>>1,n[1]=(15&s)<<7,n[1]|=(15&h)<<3,5===a&&(n[1]|=(15&u)>>>1,n[2]=(1&u)<<7,n[2]|=8,n[3]=0),{audioObjectType:a,samplingIndex:s,configRaw:r,config:n,samplingRate:l,channelCount:h,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+o}}},{key:"_parseMP3AudioData",value:function(e,t,i,r){if(i<4)return void h.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");var n=(this._littleEndian,new Uint8Array(e,t,i)),a=null;if(r){if(255!==n[0])return;var o=n[1]>>>3&3,s=(6&n[1])>>1,u=(240&n[2])>>>4,l=(12&n[2])>>>2,f=n[3]>>>6&3,c=3!==f?2:1,d=0,v=0;switch(o){case 0:d=this._mpegAudioV25SampleRateTable[l];break;case 2:d=this._mpegAudioV20SampleRateTable[l];break;case 3:d=this._mpegAudioV10SampleRateTable[l]}switch(s){case 1:34,u<this._mpegAudioL3BitRateTable.length&&(v=this._mpegAudioL3BitRateTable[u]);break;case 2:33,u<this._mpegAudioL2BitRateTable.length&&(v=this._mpegAudioL2BitRateTable[u]);break;case 3:32,u<this._mpegAudioL1BitRateTable.length&&(v=this._mpegAudioL1BitRateTable[u])}a={bitRate:v,samplingRate:d,channelCount:c,codec:"mp3",originalCodec:"mp3"}}else a=n;return a}},{key:"_parseVideoData",value:function(e,t,i,r,n){if(i<=1)return void h.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var a=new Uint8Array(e,t,i)[0],o=(240&a)>>>4,s=15&a;if(7!==s)return void this._onError(_.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+s);this._parseAVCVideoPacket(e,t+1,i-1,r,n,o)}}},{key:"_parseAVCVideoPacket",value:function(e,t,i,r,n,a){if(i<4)return void h.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var o=this._littleEndian,s=new DataView(e,t,i),u=s.getUint8(0),l=16777215&s.getUint32(0,!o),f=l<<8>>8;if(0===u)this._parseAVCDecoderConfigurationRecord(e,t+4,i-4);else if(1===u)this._parseAVCVideoData(e,t+4,i-4,r,n,a,f);else if(2!==u)return void this._onError(_.default.FORMAT_ERROR,"Flv: Invalid video packet type "+u)}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,i){if(i<7)return void h.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");var r=this._videoMetadata,n=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,i);r?void 0!==r.avcc&&h.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),r=this._videoMetadata={},r.type="video",r.id=n.id,r.timescale=this._timescale,r.duration=this._duration);var s=o.getUint8(0),u=o.getUint8(1);o.getUint8(2),o.getUint8(3);if(1!==s||0===u)return void this._onError(_.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");if(this._naluLengthSize=1+(3&o.getUint8(4)),3!==this._naluLengthSize&&4!==this._naluLengthSize)return void this._onError(_.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));var l=31&o.getUint8(5);if(0===l)return void this._onError(_.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");l>1&&h.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+l);for(var f=6,c=0;c<l;c++){var d=o.getUint16(f,!a);if(f+=2,0!==d){var p=new Uint8Array(e,t+f,d);f+=d;var y=new Uint8Array(d+4);y.set([0,0,0,1],0),y.set(p,4);var g=v.default.parseSPS(p);if(0===c){this.onVideoParseDone(y),r.codecWidth=g.codec_size.width,r.codecHeight=g.codec_size.height,r.presentWidth=g.present_size.width,r.presentHeight=g.present_size.height,r.profile=g.profile_string,r.level=g.level_string,r.bitDepth=g.bit_depth,r.chromaFormat=g.chroma_format,r.sarRatio=g.sar_ratio,r.frameRate=g.frame_rate,!1!==g.frame_rate.fixed&&0!==g.frame_rate.fps_num&&0!==g.frame_rate.fps_den||(r.frameRate=this._referenceFrameRate);var m=r.frameRate.fps_den,b=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(m/b);for(var A=p.subarray(1,4),w="avc1.",E=0;E<3;E++){var T=A[E].toString(16);T.length<2&&(T="0"+T),w+=T}r.codec=w;var x=this._mediaInfo;x.width=r.codecWidth,x.height=r.codecHeight,x.fps=r.frameRate.fps,x.profile=r.profile,x.level=r.level,x.refFrames=g.ref_frames,x.chromaFormat=g.chroma_format_string,x.sarNum=r.sarRatio.width,x.sarDen=r.sarRatio.height,x.videoCodec=w,x.hasAudio?null!=x.audioCodec&&(x.mimeType='video/x-flv; codecs="'+x.videoCodec+","+x.audioCodec+'"'):x.mimeType='video/x-flv; codecs="'+x.videoCodec+'"'}}}var C=o.getUint8(f);if(0===C)return void this._onError(_.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");C>1&&h.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+C),f++;for(var k=0;k<C;k++){var R=o.getUint16(f,!a);if(f+=2,0!==R){var L=new Uint8Array(e,t+f,R),D=new Uint8Array(R+4);D.set([0,0,0,1],0),D.set(L,4),this.onVideoParseDone(D),f+=R}}r.avcc=new Uint8Array(i),r.avcc.set(new Uint8Array(e,t,i),0),h.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1}},{key:"_parseAVCVideoData",value:function(e,t,i,r,n,a,o){for(var s=this._littleEndian,u=new DataView(e,t,i),l=[],f=0,c=0,d=this._naluLengthSize,v=this._timestampBase+r,p=1===a;c<i;){if(c+4>=i){h.default.w(this.TAG,"Malformed Nalu near timestamp "+v+", offset = "+c+", dataSize = "+i);break}var _=u.getUint32(c,!s);if(3===d&&(_>>>=8),_>i-d)return void h.default.w(this.TAG,"Malformed Nalus near timestamp "+v+", NaluSize > DataSize!");var y=31&u.getUint8(c+d);5===y&&(p=!0);var g=new Uint8Array(e,t+c,d+_),m=new Uint8Array(e,t+c,d+_);m[0]=0,m[1]=0,m[2]=0,m[3]=1,this.onVideoParseDone(m);var b={type:y,data:g};l.push(b),f+=g.byteLength,c+=d+_}if(l.length){var A=(this._videoTrack,{units:l,length:f,isKeyframe:p,dts:v,cts:o,pts:v+o});p&&(A.fileposition=n),A.dts,this.saveDts(A.dts)}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e}},{key:"onMetaDataArrived",get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e}},{key:"onScriptDataArrived",get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}},{key:"overridedDuration",get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e}},{key:"overridedHasAudio",set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e}},{key:"overridedHasVideo",set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e}}],[{key:"probe",value:function(e){var t=new Uint8Array(e),i={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return i;var r=(4&t[4])>>>2!=0,n=0!=(1&t[4]),a=o(t,5);return a<9?i:{match:!0,consumed:a,dataOffset:a,hasAudioTrack:r,hasVideoTrack:n}}}]),e}());i.default=m},{"../core/media-info.js":5,"../utils/exception.js":20,"../utils/logger.js":21,"./amf-parser.js":6,"./demux-errors.js":7,"./sps-parser.js":10}],10:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=e("./exp-golomb.js"),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){r(this,e)}return n(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,a=0;a<i;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(r[n]=t[a],n++);return new Uint8Array(r.buffer,0,n)}},{key:"parseSPS",value:function(t){var i=e._ebsp2rbsp(t),r=new o.default(i);r.readByte();var n=r.readByte();r.readByte();var a=r.readByte();r.readUEG();var s=e.getProfileString(n),u=e.getLevelString(a),l=1,h=420,f=[0,420,422,444],c=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(l=r.readUEG(),3===l&&r.readBits(1),l<=3&&(h=f[l]),c=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var d=3!==l?8:12,v=0;v<d;v++)r.readBool()&&(v<6?e._skipScalingList(r,16):e._skipScalingList(r,64));r.readUEG();var p=r.readUEG();if(0===p)r.readUEG();else if(1===p){r.readBits(1),r.readSEG(),r.readSEG();for(var _=r.readUEG(),y=0;y<_;y++)r.readSEG()}var g=r.readUEG();r.readBits(1);var m=r.readUEG(),b=r.readUEG(),A=r.readBits(1);0===A&&r.readBits(1),r.readBits(1);var w=0,E=0,T=0,x=0;r.readBool()&&(w=r.readUEG(),E=r.readUEG(),T=r.readUEG(),x=r.readUEG());var C=1,k=1,R=0,L=!0,D=0,S=0;if(r.readBool()){if(r.readBool()){var B=r.readByte(),O=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],P=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];B>0&&B<16?(C=O[B-1],k=P[B-1]):255===B&&(C=r.readByte()<<8|r.readByte(),k=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var U=r.readBits(32),I=r.readBits(32);L=r.readBool(),D=I,S=2*U,R=D/S}}var F=1;1===C&&1===k||(F=C/k);var j=0,M=0;if(0===l)j=1,M=2-A;else{var G=3===l?1:2,V=1===l?2:1;j=G,M=V*(2-A)}var N=16*(m+1),z=16*(b+1)*(2-A);N-=(w+E)*j,z-=(T+x)*M;var Y=Math.ceil(N*F);return r.destroy(),r=null,{profile_string:s,level_string:u,bit_depth:c,ref_frames:g,chroma_format:h,chroma_format_string:e.getChromaFormatString(h),frame_rate:{fixed:L,fps:R,fps_den:S,fps_num:D},sar_ratio:{width:C,height:k},codec_size:{width:N,height:z},present_size:{width:Y,height:z}}}},{key:"_skipScalingList",value:function(e,t){for(var i=8,r=8,n=0,a=0;a<t;a++)0!==r&&(n=e.readSEG(),r=(i+n+256)%256),i=0===r?i:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}();i.default=s},{"./exp-golomb.js":8}],11:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=e("./flv2canvas.loader"),s=r(o),u=e("./render/yuv-canvas"),l=r(u),h=e("./audio/pcmplayer"),f=r(h),c=function(){function e(t){n(this,e),this.playWidth=0,this.playHeight=0,this.videoBuffer=[],this.videoDts=[],this.audioDts=[],this.audioDtsCur=0,this.startPlay=!1,this.options=t,this.canvasObj={},this.initRender(),this.initAudio()}return a(e,[{key:"load",value:function(){this.loader.load()}},{key:"play",value:function(e){this.options.url=e,this.loadCtl=new s.default(this.options),this.loadCtl.saveDts=this._saveDts.bind(this),this.loader=this.loadCtl.createLoader(),this.initWorker(),this.startPlay=!0}},{key:"stop",value:function(){this.startPlay=!1}},{key:"destory",value:function(){console.log("关闭播放器");var e=this;this.avc=null,this.videoDts=[],this.videoBuffer=[],this.audioDts=[],this.loadCtl.destroy(),this.audioCtrl.destroy(),this.worker&&this.worker.terminate(),window.cancelAnimationFrame(e.interval)}},{key:"initAudio",value:function(){this.audioCtrl=new f.default({channels:1})}},{key:"initWorker",value:function(){this.worker=new Worker(this.options.workFile),this.loadCtl.worker=this.worker,this.worker.postMessage({type:"Broadway.js - Worker init",options:{rgb:!1,memsize:"",reuseMemory:!0}});var e=this;this.worker.addEventListener("message",function(t){var i=t.data;if(i.consoleLog)return void console.log(i.consoleLog);switch(t.data.type){case"playAudio":var r=t.data.buffer,n=t.data.sampleRate,a=t.data.dts;e.audioCtrl.sampleRate||(e.audioCtrl.sampleRate=n),e.doSaveAudioDts(a,r),e.audioDtsCur=a;break;case"playVideo":var o=t.data.buffer,s=t.data.width,u=t.data.height;e.onPictureDecoded(o,s,u,i.infos);break;case"initFinished":e.load()}},!1)}},{key:"initRender",value:function(){function e(){if(t.interval=requestAnimationFrame(e),t.startPlay){if(t.audioDts.length>0&&(t.audioCtrl.feed(t.audioDts[0].buffer),t.audioDts.shift()),n>400&&(console.log("重启"),t.restart&&t.restart()),n>50&&!s&&t.showLoading&&(s=!0,t.showLoading(!0)),0===t.videoBuffer.length&&t.hasFixPosition)return void n++;s&&t.showLoading&&(t.showLoading(!1),s=!1),n=0;var u=Date.now();r+=u-i,i=Date.now(),t.videoBuffer.length<10&&(a=15,o=1e3/a),t.videoBuffer.length>35&&(a=25,o=1e3/a),t.videoBuffer.length>25&&t.videoBuffer.length<40&&(a=20,o=1e3/a),r<o||t.audioDtsCur<t.videoDts[0]+1200||(r%=o,t.videoBuffer[0]?(t.renderFrame({canvasObj:t.canvasObj,data:t.videoBuffer[0],width:t.playWidth,height:t.playHeight}),t.videoDts.shift(),t.videoBuffer.shift(),t.hasFixPosition||(t.fixPosition&&t.fixPosition(),t.showLoading&&t.showLoading(!1),console.log("Start to play,and fix position"),t.hasFixPosition=!0)):console.log("no data"))}}var t=this;this.renderFrame=this.renderFrameWebGL,this.createCanvasObj=this.createCanvasWebGL,this.canvasObj=this.createCanvasObj(),this.canvasObj.canvas=this.options.canvasDom;var i=Date.now(),r=0,n=0,a=20,o=1e3/a,s=!1;e()}},{key:"doSaveAudioDts",value:function(e,t){document.hidden||this.startPlay&&this.audioDts.push({dts:e,buffer:t})}},{key:"_saveDts",value:function(e){var t=this.videoDts;if(0===t.length)this.videoDts.push(e);else if(1===t.length)e>t[0]?this.videoDts.push(e):this.videoDts.unshift(e);else{for(var i=!1,r=0;r<this.videoDts.length;r++)if(e<this.videoDts[r]||e===this.videoDts[r]){var n=t.slice(0,r),a=t.slice(r,t.length);n.push(e),this.videoDts=n.concat(a),i=!0;break}i||this.videoDts.push(e)}}},{key:"onPictureDecoded",value:function(e,t,i,r){if(!document.hidden){this.playWidth=t,this.playHeight=i,this.videoBuffer.push(new Uint8Array(e));var n=this;if(this.videoBuffer.length>50&&!this.startPlay){console.log("clear",this.videoBuffer.length,this.videoDts.length),this.videoBuffer=[],n.videoDts=[];for(var a=0;a<50;)n.videoDts.shift(),a++}}}},{key:"renderFrameWebGL",value:function(e){var t=e.canvasObj,i=e.width||t.canvas.width,r=e.height||t.canvas.height;t.canvas.width===i&&t.canvas.height===r&&t.webGLCanvas||(t.canvas.width=i,t.canvas.height=r,t.webGLCanvas=new l.default({canvas:t.canvas,contextOptions:t.contextOptions,width:i,height:r}));var n=i*r,a=i/2*(r/2);t.webGLCanvas.drawNextOutputPicture({yData:e.data.subarray(0,n),uData:e.data.subarray(n,n+a),vData:e.data.subarray(n+a,n+a+a)}),this.recycleMemory(e.data)}},{key:"recycleMemory",value:function(e){this.worker.postMessage({reuse:e.buffer},[e.buffer])}},{key:"createCanvasWebGL",value:function(e){return this._createBasicCanvasObj(e)}},{key:"_createBasicCanvasObj",value:function(e){e=e||{};var t={};return t.canvas=document.createElement("canvas"),t.canvas.style.backgroundColor="#0D0E1B",t}}]),e}();i.default=c},{"./audio/pcmplayer":4,"./flv2canvas.loader":12,"./render/yuv-canvas":18}],12:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=e("./utils/polyfill.js"),s=r(o),u=e("./loader/io-controller"),l=r(u);s.default.install();var h=function(){function e(t){n(this,e),this._config=t}return a(e,[{key:"createLoader",value:function(){return this.ioctl=new l.default(this._config),this.ioctl.onVideoParseDone=this._onVideoParseDone.bind(this),this.ioctl.onAudioParseDone=this._onAudioParseDone.bind(this),this.ioctl.saveDts=this._saveDts.bind(this),this.ioctl}},{key:"_onVideoParseDone",value:function(e){this.worker.postMessage({type:"sendArrayVideo",buffer:e})}},{key:"_saveDts",value:function(e){this.saveDts(e)}},{key:"_onAudioParseDone",value:function(e){this.worker.postMessage({type:"sendArrayAudio",buffer:e})}},{key:"destroy",value:function(){this.ioctl.destroy()}}]),e}();i.default=h},{"./loader/io-controller":15,"./utils/polyfill.js":22}],13:[function(e,t,i){"use strict";t.exports=e("./flv2canvas.js").default},{"./flv2canvas.js":11}],14:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},u=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),l=e("../utils/browser.js"),h=function(e){return e&&e.__esModule?e:{default:e}}(l),f=e("./loader.js"),c=function(e){function t(e){r(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"fetch-stream-loader"));return i.TAG="FetchStreamLoader",i._config=e,i._needStash=!0,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}return a(t,e),u(t,null,[{key:"isSupported",value:function(){try{var e=h.default.msedge&&h.default.version.minor>=15048,t=!h.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}}}]),u(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(){var e=this,t=new self.Headers,i={method:"GET",headers:t,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"===o(this._config.headers))for(var r in this._config.headers)t.append(r,this._config.headers[r]);this._status=f.LoaderStatus.kConnecting,self.fetch(this._config.url,i).then(function(t){if(t.ok&&t.status>=200&&t.status<=299){var i=t.headers.get("Content-Length");return null!=i&&(e._contentLength=parseInt(i),0!==e._contentLength&&e._onContentLengthKnown&&e._onContentLengthKnown(e._contentLength)),e._pump.call(e,t.body.getReader())}e._status=f.LoaderStatus.kError,e._onError&&e._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}).catch(function(t){if(e._status=f.LoaderStatus.kError,!e._onError)throw t;e._onError(f.LoaderErrors.EXCEPTION,{code:-1,msg:t.message})})}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"_pump",value:function(e){var t=this;return e.read().then(function(i){if(i.done){if(!0===t._requestAbort)return t._requestAbort=!1,t._status=f.LoaderStatus.kComplete,e.cancel();t._status=f.LoaderStatus.kBuffering;var r=i.value.buffer,n=t._range.from+t._receivedLength;t._receivedLength+=r.byteLength,t._onDataArrival&&t._onDataArrival(r,n,t._receivedLength),t._pump(e)}else{if(!0===t._requestAbort)return t._requestAbort=!1,t._status=f.LoaderStatus.kComplete,e.cancel();t._status=f.LoaderStatus.kBuffering;var a=i.value.buffer,o=t._receivedLength;if(t._receivedLength+=a.byteLength,t._onDataArrival)try{t._onDataArrival(a,o,t._receivedLength)}catch(e){console.log(e)}t._pump(e)}}).catch(function(e){if(11!==e.code||!h.default.msedge){t._status=f.LoaderStatus.kError;var i=0,r=null;19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(i=f.LoaderErrors.EXCEPTION,r={code:e.code,msg:e.message}):(i=f.LoaderErrors.EARLY_EOF,r={code:e.code,msg:"Fetch stream meet Early-EOF"}),t._onError&&t._onError(i,r)}})}}]),t}(f.BaseLoader);i.default=c},{"../utils/browser.js":19,"./loader.js":16}],15:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=e("./fetch-stream-loader.js"),s=r(o),u=e("events"),l=r(u),h=e("../demux/flv-demuxer.js"),f=r(h),c=e("./speed-sampler.js"),d=r(c),v=function(){function e(t){n(this,e),this._config=t,this._loader=null,this._loaderClass=null,this._seekHandler=null,this._emitter=new l.default,this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!1,!1===t.enableStashBuffer&&(this._enableStash=!1),this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new d.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._selectLoader(),this._createLoader()}return a(e,[{key:"_selectLoader",value:function(){s.default.isSupported()&&(this._loaderClass=s.default)}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1)}},{key:"load",value:function(){this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.open()}},{key:"_onInitChunkArrival",value:function(e,t){var i=null,r=0;return t>0?(this._demuxer.bindDataSource(this._loader),r=this._demuxer.parseChunks(e,t)):(i=f.default.probe(e)).match?(this._demuxer=new f.default(i,this._config),this._demuxer.onVideoParseDone=this._onVideoParseDone.bind(this),this._demuxer.onAudioParseDone=this._onAudioParseDone.bind(this),this._demuxer.saveDts=this._saveDts.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),r=this._demuxer.parseChunks(e,t)):i=null,r}},{key:"_normalizeSpeed",value:function(e){var t=this._speedNormalizeList,i=t.length-1,r=0,n=0,a=i;if(e<t[0])return t[0];for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?n=r+1:a=r-1}}},{key:"_onLoaderChunkArrival",value:function(e,t,i){try{if(this._onDataArrival,this._paused)return;this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var r=this._speedSampler.lastSecondKBps;if(0!==r){var n=this._normalizeSpeed(r);this._speedNormalized!==n&&(this._speedNormalized=n,this._adjustStashSize(n))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize){var a=new Uint8Array(this._stashBuffer,0,this._stashSize);a.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var o=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed),u=this._dispatchChunks(s,this._stashByteStart);if(u<s.byteLength){if(u>0){var l=new Uint8Array(s,u);o.set(l,0),this._stashUsed=l.byteLength,this._stashByteStart+=u}}else this._stashUsed=0,this._stashByteStart+=u;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var h=this._dispatchChunks(e,t);if(h<e.byteLength){var f=e.byteLength-h;f>this._bufferSize&&(this._expandBuffer(f),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,h),0),this._stashUsed+=f,this._stashByteStart=t+h}}}else if(0===this._stashUsed){var c=this._dispatchChunks(e,t);if(c<e.byteLength){var d=e.byteLength-c;d>this._bufferSize&&this._expandBuffer(d);var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);v.set(new Uint8Array(e,c),0),this._stashUsed+=d,this._stashByteStart=t+c}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var p=new Uint8Array(this._stashBuffer,0,this._bufferSize);p.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var _=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(_<this._stashUsed&&_>0){var y=new Uint8Array(this._stashBuffer,_);p.set(y,0)}this._stashUsed-=_,this._stashByteStart+=_}}catch(e){console.log(e)}}},{key:"_adjustStashSize",value:function(e){var t=0;(t=this._config.isLive?e:e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var i=1024*t+1048576;this._bufferSize<i&&this._expandBuffer(i),this._stashSize=1024*t}},{key:"_expandBuffer",value:function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var i=new ArrayBuffer(t);if(this._stashUsed>0){var r=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(i,0,t).set(r,0)}this._stashBuffer=i,this._bufferSize=t}}},{key:"_dispatchChunks",value:function(e,t){return this._onInitChunkArrival(e,t)}},{key:"_onScriptDataArrived",value:function(e){}},{key:"_onVideoParseDone",value:function(e){this.onVideoParseDone(e)}},{key:"_onAudioParseDone",value:function(e){this.onAudioParseDone(e)}},{key:"_saveDts",value:function(e){this.saveDts(e)}},{key:"destroy",value:function(){this._loader.destroy()}},{key:"onVideoParseDone",value:function(){}},{key:"onAudioParseDone",value:function(){}}]),e}();i.default=v},{"../demux/flv-demuxer.js":9,
"./fetch-stream-loader.js":14,"./speed-sampler.js":17,events:2}],16:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};i.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},i.BaseLoader=function(){function e(t){r(this,e),this._type=t||"undefined",this._status=a.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return n(e,[{key:"destroy",value:function(){this._status=a.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===a.kConnecting||this._status===a.kBuffering}},{key:"open",value:function(e,t){}},{key:"abort",value:function(){}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),e}()},{}],17:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return n(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}},{key:"averageKBps",get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024}}]),e}();i.default=a},{}],18:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),t=t||{},this.canvasElement=t.canvas||document.createElement("canvas"),this.contextOptions=t.contextOptions,this.type=t.type||"yuv420",this.customYUV444=t.customYUV444,this.conversionType=t.conversionType||"rec601",this.width=t.width||640,this.height=t.height||320,this.animationTime=t.animationTime||0,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.initContextGL(),this.contextGL&&(this.initProgram(),this.initBuffers(),this.initTextures()),"yuv420"===this.type?this.drawNextOuptutPictureGL=function(e){var t=this.contextGL,i=this.texturePosBuffer,r=this.uTexturePosBuffer,n=this.vTexturePosBuffer,a=this.yTextureRef,o=this.uTextureRef,s=this.vTextureRef,u=e.yData,l=e.uData,h=e.vData,f=this.width,c=this.height,d=e.yDataPerRow||f,v=e.yRowCnt||c,p=e.uDataPerRow||f/2,_=e.uRowCnt||c/2,y=e.vDataPerRow||p,g=e.vRowCnt||_;t.viewport(0,0,f,c);var m=c/v,b=f/d,A=new Float32Array([b,0,0,0,b,m,0,m]);t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,A,t.DYNAMIC_DRAW),this.customYUV444?(m=c/_,b=f/p):(m=c/2/_,b=f/2/p);var w=new Float32Array([b,0,0,0,b,m,0,m]);t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,w,t.DYNAMIC_DRAW),this.customYUV444?(m=c/g,b=f/y):(m=c/2/g,b=f/2/y);var E=new Float32Array([b,0,0,0,b,m,0,m]);t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,E,t.DYNAMIC_DRAW),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,d,v,0,t.LUMINANCE,t.UNSIGNED_BYTE,u),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,p,_,0,t.LUMINANCE,t.UNSIGNED_BYTE,l),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,y,g,0,t.LUMINANCE,t.UNSIGNED_BYTE,h),t.drawArrays(t.TRIANGLE_STRIP,0,4)}:"yuv422"===this.type&&(this.drawNextOuptutPictureGL=function(e){var t=this.contextGL,i=this.texturePosBuffer,r=this.textureRef,n=e.data,a=this.width,o=this.height,s=e.dataPerRow||2*a,u=e.rowCnt||o;t.viewport(0,0,a,o);var l=o/u,h=a/(s/2),f=new Float32Array([h,0,0,0,h,l,0,l]);t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,f,t.DYNAMIC_DRAW),t.uniform2f(t.getUniformLocation(this.shaderProgram,"resolution"),s,o),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,s,u,0,t.LUMINANCE,t.UNSIGNED_BYTE,n),t.drawArrays(t.TRIANGLE_STRIP,0,4)})}return n(e,[{key:"isWebGL",value:function(){return this.contextGL}},{key:"initContextGL",value:function(){for(var e=this.canvasElement,t=null,i=["webgl","experimental-webgl","moz-webgl","webkit-3d"],r=0;!t&&r<i.length;){var n=i[r];try{t=this.contextOptions?e.getContext(n,this.contextOptions):e.getContext(n)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++r}this.contextGL=t}},{key:"initProgram",value:function(){var e=this.contextGL,t=void 0,i=void 0;"yuv420"===this.type?(t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),i=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n")):"yuv422"===this.type&&(t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","}"].join("\n"),i=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform highp vec2 resolution;","uniform mat4 YUV2RGB;","void main(void) {","  highp float texPixX = 1.0 / resolution.x;","  highp float logPixX = 2.0 / resolution.x;","  highp float logHalfPixX = 4.0 / resolution.x;","  highp float steps = floor(textureCoord.x / logPixX);","  highp float uvSteps = floor(textureCoord.x / logHalfPixX);","  highp float y = texture2D(sampler, vec2((logPixX * steps) + texPixX, textureCoord.y)).r;","  highp float u = texture2D(sampler, vec2((logHalfPixX * uvSteps), textureCoord.y)).r;","  highp float v = texture2D(sampler, vec2((logHalfPixX * uvSteps) + texPixX + texPixX, textureCoord.y)).r;","  gl_FragColor = vec4(y, u, v, 1.0) * YUV2RGB;","}"].join("\n"));var r=[];r="rec709"==this.conversionType?[1.16438,0,1.79274,-.97295,1.16438,-.21325,-.53291,.30148,1.16438,2.1124,0,-1.1334,0,0,0,1]:[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];var n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(n));var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,i),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(a));var o=e.createProgram();e.attachShader(o,n),e.attachShader(o,a),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||console.log("Program failed to compile: "+e.getProgramInfoLog(o)),e.useProgram(o);var s=e.getUniformLocation(o,"YUV2RGB");e.uniformMatrix4fv(s,!1,r),this.shaderProgram=o}},{key:"initBuffers",value:function(){var e=this.contextGL,t=this.shaderProgram,i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var r=e.getAttribLocation(t,"vertexPos");if(e.enableVertexAttribArray(r),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0),this.animationTime){var n=this.animationTime,a=0;!function i(){a+=15;var r=1*a/n;a>=n?r=1:setTimeout(i,15);var o=-1*r,s=1*r,u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([s,s,o,s,s,o,o,o]),e.STATIC_DRAW);var l=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0);try{e.drawArrays(e.TRIANGLE_STRIP,0,4)}catch(e){console.log()}}()}var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.texturePosBuffer=o,"yuv420"===this.type){var u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var l=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=u;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var f=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(f),e.vertexAttribPointer(f,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=h}}},{key:"initTextures",value:function(){var e=this.contextGL,t=this.shaderProgram;if("yuv420"===this.type){var i=this.initTexture(),r=e.getUniformLocation(t,"ySampler");e.uniform1i(r,0),this.yTextureRef=i;var n=this.initTexture(),a=e.getUniformLocation(t,"uSampler");e.uniform1i(a,1),this.uTextureRef=n;var o=this.initTexture(),s=e.getUniformLocation(t,"vSampler");e.uniform1i(s,2),this.vTextureRef=o}else if("yuv422"===this.type){var u=this.initTexture(),l=e.getUniformLocation(t,"sampler");e.uniform1i(l,0),this.textureRef=u}}},{key:"initTexture",value:function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}},{key:"drawNextOutputPicture",value:function(e,t,i,r){this.contextGL?this.drawNextOuptutPictureGL(e,t,i,r):this.drawNextOuptutPictureRGBA(e,t,i,r)}},{key:"drawNextOuptutPictureRGBA",value:function(e,t,i,r){var n=this.canvasElement;i=null;var a=r,o=n.getContext("2d"),s=o.getImageData(0,0,e,t);s.data.set(a),null===i?o.putImageData(s,0,0):o.putImageData(s,-i.left,-i.top,0,0,i.width,i.height)}}]),e}();i.default=a},{}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},a={};if(n.browser){a[n.browser]=!0;var o=n.majorVersion.split(".");a.version={major:parseInt(n.majorVersion,10),string:n.version},o.length>1&&(a.version.minor=parseInt(o[1],10)),o.length>2&&(a.version.build=parseInt(o[2],10))}n.platform&&(a[n.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,n.browser="msie",a.msie=!0),a.edge&&(delete a.edge,n.browser="msedge",a.msedge=!0),a.opr&&(n.browser="opera",a.opera=!0),a.safari&&a.android&&(n.browser="android",a.android=!0),a.name=n.browser,a.platform=n.platform;for(var s in r)r.hasOwnProperty(s)&&delete r[s];Object.assign(r,a)}(),i.default=r},{}],20:[function(e,t,i){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=i.RuntimeException=function(){function e(t){a(this,e),this._message=t}return o(e,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),e}();i.IllegalStateException=function(e){function t(e){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return n(t,e),o(t,[{key:"name",get:function(){return"IllegalStateException"}}]),t}(s),i.InvalidArgumentException=function(e){function t(e){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return n(t,e),o(t,[{key:"name",get:function(){return"InvalidArgumentException"}}]),t}(s),i.NotImplementedException=function(e){function t(e){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return n(t,e),o(t,[{key:"name",get:function(){return"NotImplementedException"}}]),t}(s)},{}],21:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=e("events"),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){r(this,e)}return n(e,null,[{key:"e",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",r),e.ENABLE_ERROR&&(console.error?console.error(r):console.warn?console.warn(r):console.log(r))}},{key:"i",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",r),e.ENABLE_INFO&&(console.info?console.info(r):console.log(r))}},{key:"w",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",r),e.ENABLE_WARN&&(console.warn?console.warn(r):console.log(r))}},{key:"d",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",r),e.ENABLE_DEBUG&&(console.debug?console.debug(r):console.log(r))}},{key:"v",value:function(t,i){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+i;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",r),e.ENABLE_VERBOSE&&console.log(r)}}]),e}();s.GLOBAL_TAG="flv.js",s.FORCE_GLOBAL_TAG=!1,s.ENABLE_ERROR=!0,s.ENABLE_INFO=!0,s.ENABLE_WARN=!0,s.ENABLE_DEBUG=!0,s.ENABLE_VERBOSE=!0,s.ENABLE_CALLBACK=!1,s.emitter=new o.default,i.default=s},{events:2}],22:[function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function(){function t(){r(this,t)}return n(t,null,[{key:"install",value:function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(void 0!==r&&null!==r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t},"function"!=typeof self.Promise&&e("es6-promise").polyfill()}}]),t}();a.install(),i.default=a},{"es6-promise":1}],23:[function(e,t,i){"use strict";function r(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}function n(e){for(var t=[],i=e,n=0,a=e.length;n<a;)if(i[n]<128)t.push(String.fromCharCode(i[n])),++n;else{if(i[n]<192);else if(i[n]<224){if(r(i,n,1)){var o=(31&i[n])<<6|63&i[n+1];if(o>=128){t.push(String.fromCharCode(65535&o)),n+=2;continue}}}else if(i[n]<240){if(r(i,n,2)){var s=(15&i[n])<<12|(63&i[n+1])<<6|63&i[n+2];if(s>=2048&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),n+=3;continue}}}else if(i[n]<248&&r(i,n,3)){var u=(7&i[n])<<18|(63&i[n+1])<<12|(63&i[n+2])<<6|63&i[n+3];if(u>65536&&u<1114112){u-=65536,t.push(String.fromCharCode(u>>>10|55296)),t.push(String.fromCharCode(1023&u|56320)),n+=4;continue}}t.push(String.fromCharCode(65533)),++n}return t.join("")}Object.defineProperty(i,"__esModule",{value:!0}),i.default=n},{}]},{},[13])(13)});
//# sourceMappingURL=flv2canvas.min.js.map
